<!DOCTYPE html>
<html>
<head>
<style>
    #slideshow {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        z-index: -1;
    }
    #slideshow img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        opacity: 0;
        transition: opacity 1s ease-in-out;
    }
    #slideshow img.show {
        opacity: 1;
    }
</style>
</head>
<body>
<div id="slideshow"></div>
<script>
var slideshowDiv = document.getElementById('slideshow');
var index = 0;
var fileUrls = [];
var currentUrl = null;
let newFileUrls = [];  // A new array to hold the updated list of file URLs

// Fetch the list of image URLs from your Apps Script web app
fetchImages();

// Fetch images every 10 minutes
setInterval(fetchImages, 2 * 60 * 1000);

function fetchImages() {
    fetch('https://script.google.com/macros/s/AKfycbzhUGteNZbZFkddrp5abAAVA80HVFvKna0jnqtJzFoD3zxMgcN1CNFsKZOwBBwzC4muWA/exec?time=' + new Date().getTime())
        .then(response => response.json())
        .then(data => {
            newFileUrls = data;  // Update newFileUrls instead of fileUrls

            // If there's no slideshow running yet, start it
            if (!currentUrl && newFileUrls.length > 0) {
                currentUrl = newFileUrls[0]; // set the first url
                nextSlide();
                setInterval(nextSlide, 3000);
            }
        });
}

function nextSlide() {
    // If newFileUrls is not empty, update fileUrls and index
    if (newFileUrls.length > 0) {
        fileUrls = newFileUrls;
        index = fileUrls.indexOf(currentUrl);
        if (index === -1 || index >= fileUrls.length) {
            index = 0;
        }
    }

    if (fileUrls.length > 0) {
        let img;
        // If an image for this index does not exist, create it
        if (slideshowDiv.children[index]) {
            img = slideshowDiv.children[index];
        } else {
            img = document.createElement('img');
            img.src = fileUrls[index];
            slideshowDiv.appendChild(img);
        }

        // Hide all images
        Array.from(slideshowDiv.children).forEach(img => img.style.opacity = 0);
        // Show the current image
        img.style.opacity = 1;

        // Preload the next image
        var nextImage = new Image();
        nextImage.src = fileUrls[(index + 1) % fileUrls.length];

        currentUrl = fileUrls[index];
        index = (index + 1) % fileUrls.length;
    }
}
</script>
</body>
</html>

