<!DOCTYPE html>
<html>
<head>
    <title>Slideshow</title>
  <style>
  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;  // prevent scrolling
  }

  #slideshow {
    position: relative;
    width: 100vw;  // use viewport units
    height: 100vh;
    overflow: hidden;  // clip any overflowing images
  }

  #slideshow img {
    position: absolute;  // position images absolutely within #slideshow
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;  // cover the whole area
    opacity: 0;
    transition: opacity 1s ease-in-out;
  }

  #slideshow img.show {
    opacity: 1;
  }
</style>

    
</head>
<body>
    <div id="slideshow"></div>
    
    <script>
var slideshowDiv = document.getElementById('slideshow');
var index = 0;
var imgElements = [];
        let newFileUrls = []; 

// Fetch the list of image URLs from your Apps Script web app
fetchImages();

// Fetch images every 10 minutes
setInterval(fetchImages, 10 * 60 * 1000);

// Start the slideshow
setInterval(nextSlide, 3000);

function fetchImages() {
    fetch('https://script.google.com/macros/s/AKfycbzhUGteNZbZFkddrp5abAAVA80HVFvKna0jnqtJzFoD3zxMgcN1CNFsKZOwBBwzC4muWA/exec?time=' + new Date().getTime())
        .then(response => response.json())
        .then(data => {
            // Start preloading all images
            let loadingImages = data.map((url, i) => {
                return new Promise((resolve, reject) => {
                    let img = new Image();
                    img.onload = () => resolve({url: url, element: img, index: i});
                    img.onerror = reject;
                    img.src = url;
                });
            });

            // After all images are loaded, update imgElements
            Promise.all(loadingImages).then(images => {
                images.sort((a, b) => a.index - b.index).forEach((img, i) => {
                    if (imgElements[i]) {
                        // Update the src of an existing image element
                        imgElements[i].src = img.url;
                    } else {
                        // Create a new image element for a new URL
                        img.element.style.display = 'none';  // Set the initial display state to 'none'
                        slideshowDiv.appendChild(img.element);
                        imgElements.push(img.element);
                    }
                });

                // Remove extra image elements if any URLs were deleted
                while (imgElements.length > data.length) {
                    imgElements.pop().remove();
                }

                // Make sure at least one image is visible
                if (imgElements.length > 0 && imgElements[index].style.display === 'none') {
                    imgElements[index].style.display = 'block';
                }
            }).catch(console.error);
        });
}


function nextSlide() {
    // If newFileUrls is not empty, update fileUrls and index
    if (newFileUrls.length > 0) {
        fileUrls = newFileUrls;
        index = fileUrls.indexOf(currentUrl);
        if (index === -1 || index >= fileUrls.length) {
            index = 0;
        }
    }

    if (fileUrls.length > 0) {
        let img;
        // If an image for this index does not exist, create it
        if (slideshowDiv.children[index]) {
            img = slideshowDiv.children[index];
        } else {
            img = document.createElement('img');
            img.src = fileUrls[index];
            slideshowDiv.appendChild(img);
        }

        // Hide all images
        Array.from(slideshowDiv.children).forEach(img => img.classList.remove('show'));
        // Show the current image
        img.classList.add('show');

        // Preload the next image
        var nextImage = new Image();
        nextImage.src = fileUrls[(index + 1) % fileUrls.length];

        index = (index + 1) % fileUrls.length;
    }
}



    </script>
</body>
</html>
