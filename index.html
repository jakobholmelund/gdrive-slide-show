<!DOCTYPE html>
<html>
<head>
    <title>Slideshow</title>
    <style>
body, html {
    height: 100%;
    margin: 0;
    padding: 0;
}


        #slideshow {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

#slideshow img {
    position: absolute;
    left: 50%;
    top: 50%;
    height: 100%;
    width: 100%;
    min-height: 100%;
    min-width: 100%;
    transform: translate(-50%, -50%);
    object-fit: cover;
    transition: opacity 1s;
    opacity: 0;
}

#slideshow img.show {
    opacity: 1;
}

        
    </style>
    
</head>
<body>
    <div id="slideshow"></div>
    
    <script>
var slideshowDiv = null;
var slideIndex = 0;
var index = 0;
var fileUrls = [];
var currentUrl = null;
let newFileUrls = [];  // A new array to hold the updated list of file URLs

window.onload = function() {
  slideshowDiv = document.getElementById('slideshow');

  // Fetch the list of image URLs from your Apps Script web app
  fetchImages();

  // Fetch images every 10 minutes
  setInterval(fetchImages, 2 * 60 * 1000);
}

function fetchImages() {
    if (fileUrls.length > 0) {
        currentUrl = fileUrls[slideIndex];
    }
    
    fetch('https://script.google.com/macros/s/AKfycbzhUGteNZbZFkddrp5abAAVA80HVFvKna0jnqtJzFoD3zxMgcN1CNFsKZOwBBwzC4muWA/exec?time=' + new Date().getTime())
        .then(response => response.json())
        .then(data => {
            newFileUrls = data;  // Update newFileUrls instead of fileUrls

            // If there's no slideshow running yet, start it
            if (!currentUrl) {
                nextSlide();
                setInterval(nextSlide, 3000);
            }
        });
}

function nextSlide() {
    // If newFileUrls is not empty, update fileUrls and index
    if (newFileUrls.length > 0) {
        fileUrls = newFileUrls;
        slideIndex = fileUrls.indexOf(currentUrl);
        if (slideIndex === -1) {
            slideIndex = 0;
        }
    }
    
    if (fileUrls.length > 0) {
        var img;
        // If an image for this index does not exist, create it
        if (slideshowDiv.children[slideIndex]) {
            img = slideshowDiv.children[slideIndex];
        } else {
            img = document.createElement('img');
            img.src = fileUrls[slideIndex];
            slideshowDiv.appendChild(img);
        }
        // Hide all images
        Array.from(slideshowDiv.children).forEach(img => img.classList.remove('show'));
        // Show the current image
        img.classList.add('show');

        // Preload the next image
        var nextImage = new Image();
        nextImage.src = fileUrls[(slideIndex + 1) % fileUrls.length];

        slideIndex = (slideIndex + 1) % fileUrls.length;
    }
}

    </script>
</body>
</html>
